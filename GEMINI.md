# AgentLeeOps

## Project Overview

AgentLeeOps is a Python-based orchestration framework designed to manage high-discipline, multi-agent software development workflows. It integrates with **Kanboard** to enforce a strict 10-stage pipeline that governs the software lifecycle from idea to delivery.

The core philosophy revolves around:
*   **The Ratchet Effect:** Progress is gated by human approval. Once a stage (Design, Tests, Plan) is approved, agents cannot regress without explicit permission.
*   **Double-Blind Implementation:** The agent writing the code (Ralph) is distinct from the agent writing the tests, ensuring integrity.
*   **Artifact-Driven:** Durable decisions are recorded in version-controlled files (`DESIGN.md`, `prd.json`) rather than ephemeral chat logs.

## Building and Running

### Prerequisites
*   **Python 3.x**
*   **Kanboard:** Must be running (typically via Docker on port 88) with the **MetaMagik** plugin installed for custom fields.
*   **OpenCode CLI:** Required for LLM agent interactions.

### Setup Environment
1.  **Create Virtual Environment:**
    ```bash
    python -m venv .venv
    source .venv/bin/activate
    pip install -r requirements.txt
    ```
2.  **Configure Environment:**
    Copy the example configuration and set your Kanboard credentials (API token).
    ```bash
    cp .env.example .env
    # Edit .env to set KANBOARD_TOKEN, etc.
    ```
3.  **Initialize Board:**
    Run the setup script to configure the 10-column Kanboard pipeline.
    ```bash
    python setup-board.py
    ```

### Execution Modes
The system can be run in different modes depending on your needs:

*   **Webhook Mode (Recommended):**
    Starts a server to listen for Kanboard webhooks (triggers automation immediately upon card movement).
    ```bash
    python webhook_server.py --port 5000
    ```

*   **Polling Mode:**
    Continuously polls Kanboard for changes.
    ```bash
    python orchestrator.py --poll-interval 10
    ```

*   **Single Run:**
    Runs the orchestrator once and exits (useful for debugging).
    ```bash
    python orchestrator.py --once
    ```

## Development Conventions

### Architecture
*   **`orchestrator.py`**: The main logic that drives the workflow state machine.
*   **`webhook_server.py`**: Entry point for HTTP-based triggers.
*   **`agents/`**: Contains specific agent implementations (e.g., `architect.py` for design).
*   **`lib/`**: Shared utilities including:
    *   `workspace.py`: Workspace management
    *   `task_fields.py`: Task parsing
    *   `llm/`: LLM provider abstraction (role-based routing, multiple provider support)

### Workflow Rules
1.  **Input Contract:** Work items (Kanboard cards) must specify a `dirname` (project folder name) and `context_mode` (`NEW` or `FEATURE`) via custom fields or YAML description.
2.  **Test Integrity:** Agents are strictly forbidden from modifying files in `tests/` unless the card is explicitly in the "Repo & Tests Draft" column.
3.  **Context Modes:**
    *   **NEW:** Creates a fresh git repository and workspace.
    *   **FEATURE:** Works within an existing repository, creating a feature branch.

### Coding Style
*   **Python:** Follows standard Python conventions (PEP 8).
*   **Formatting:** 4-space indentation.
*   **Typing:** Type hints are encouraged for public interfaces.
*   **Logging:** Use standard logging or print statements for CLI output; avoid leaking secrets.

### Testing
*   Tests for the framework itself should be run using `pytest` (if/when available).
*   Tests for managed projects are generated by the "Test Agent" and run by the "Implementation Agent" (Ralph).
